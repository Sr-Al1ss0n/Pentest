# Cmess

[https://tryhackme.com/room/cmess](https://tryhackme.com/room/cmess)

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled.png)

A room pede para adicionar o dominio deles

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%201.png)

Valendo 5pts no skill up (+ 5pts por estar na call, + 5pts se ficar até o fim da call) 

# Information Gathering

IP: 10.10.72.201

Começando pelo nmap e partindo para o web

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%202.png)

ttl = 64 → Linux

Enumerando a aplicação web

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%203.png)

Procurando por exploits desse CMS (Gila)

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%204.png)

Tentei rodar os exploits, nenhum deles funcionou pelo mesmo motivo, ele não tinha a função vulnerável habilitada 

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%205.png)

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%206.png)

Voltei a enumerar a aplicação

Robots.txt está aberto

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%207.png)

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%208.png)

Foi analisando os exploits e tentando reproduzir de forma manual que encontrei o painel de admin / login

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%209.png)

Fuzzing de diretórios 

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2010.png)

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2011.png)

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2012.png)

Tentando executar o exploit

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2013.png)

→ sem sucesso

Enumerando subdomínios com o gobuster

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2014.png)

Em dev temos uma conversa entre o suporte e um usuário 

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2015.png)

Aqui temos emails e uma senha

# Gain Access

Ao fazer o login ele te redireciona o para o index.html

então depois tentei acessar o /admin e funcionou 

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2016.png)

Primeiro pesquisei exploits para essa versão em especifico 

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2017.png)

Explorando a aplicação foi possível encontrar uma função onde consegui editar códigos php, então inseri um código malicioso e fiz as requests pela página principal 

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2018.png)

Reverse shell em python

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2019.png)

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2020.png)

Recebendo a shell pelo netcat e fazendo um upgrade de shell

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2021.png)

# Privilege Escalation

subi um servidor http na minha máquina e baixei o [linpeas.sh](http://linpeas.sh) na máquina alvo

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2022.png)

Resultado de algo interessante da ferramenta.

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2023.png)

Analisando o crontab é possível perceber uma possível falha [wildcard injection](https://systemweakness.com/privilege-escalation-using-wildcard-injection-tar-wildcard-injection-a57bc81df61c?gi=38686c76fe48)

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2024.png)

No /opt tem a senha do usuário (isso foi bem zoado) (linpeas que pegou esse arquivo)

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2025.png)

Conectei como andre via ssh

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2026.png)

### Como explorar a falha de wildcard ?

Quando temos um comando executando o comando com o * no final ele irá pegar todos os arquivos do diretório e colocar o nome dele no final do comando e então nos criamos arquivos com parâmetros da ferramenta.

Acredito que esse artigo irá explicar muito melhor a respeito dessa falha

[https://www.hackingarticles.in/exploiting-wildcard-for-privilege-escalation/](https://www.hackingarticles.in/exploiting-wildcard-for-privilege-escalation/)

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2027.png)

![Untitled](Cmess%20a5519bacd16f4ebf984e93c0fad8b479/Untitled%2028.png)