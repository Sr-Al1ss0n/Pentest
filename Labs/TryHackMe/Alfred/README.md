# Alfred

[https://tryhackme.com/room/alfred](https://tryhackme.com/room/alfred)

IP: 10.10.52.105

# Scanning & Enumeration

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled.png)

Comecei pela enumeração do servidor web

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%201.png)

Antes de eu partir para uma enumeração mais profunda do primeiro servidor web, foi colhetar informações no segundo

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%202.png)

Se temos uma tela de login, podemos é claro executar um brute-force, porém no primeiro momento é ideal pesquisar as credenciais padrões da aplicação (que já sabemos que é um jenkins)

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%203.png)

# Gain Access

Testei a senha admin:admin e funcionou 

Temos um painel administrativo CMS

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%204.png)

→ Geralmente esse tipo de aplicação é bem vulnerável 

Enumerando a aplicação encontrei essa funções que podem ser extremamente interessante 

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%205.png)

Temos os sistema windows 7 (6.1), e a aplicação usa java

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%206.png)

Testando executar comandos do ambiente nessa função 

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%207.png)

Subi um servidor com o arquivo de reverse shell

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%208.png)

subi o listener

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%209.png)

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2010.png)

Infelizmente não consegui um reverse shell assim

Porém na parte de build podemos analisar o seguintes caso

Na parte [http://10.10.52.105:8080/job/project/configure](http://10.10.52.105:8080/job/project/configure)

podemos ver que ele chama o comando whoami

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2011.png)

Esse que é retornado em

# Invasion

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2012.png)

Alterei o whoami para 

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2013.png)

E obtive 

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2014.png)

Testei com o comando dir também

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2015.png)

Logo temos um RCE, com isso é extremamente útil conseguir uma shell reversa para facilitar a vida

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2016.png)

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2017.png)

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2018.png)

# Privilege Escalation

Tenho uma reverse shell normal, seguindo o processo da room ela me recomenda obter uma shell meterpreter

Para isso irei começar criando um payload de reverse shell, encodado para evitar treta com antivirus (não que eu acho que isso vá fazer muita diferença, afinal é meterpreter, qualquer antivirus deve ser capaz de bloquar)

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2019.png)

baixando ele para dentro da máquina && executando

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2020.png)

Recebendo ele com um handler (não pode ser via nc, pois precisaremos de uns modulos do metasploit)

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2021.png)

---

### Easy

Escalando o privilegio ( a partir do momento que eu tinha o acesso só precisei executar isso)

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2022.png)

Porém por questões de estudos iremos executar esse processo na mão

---

### “hard”

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2023.png)

Carregando o modulo incognito no meterpreter 

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2024.png)

Novo help com o modulo 

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2025.png)

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2026.png)

![Untitled](Alfred%208d8cc85ed39f4bd2ba814102651d98fa/Untitled%2027.png)

Disclaimer: Talvez no futuro eu volte nessa máquina para tentar executar exploit na mão