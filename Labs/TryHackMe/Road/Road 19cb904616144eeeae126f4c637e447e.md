# Road

[https://tryhackme.com/room/road](https://tryhackme.com/room/road)

IP: 10.10.73.198

Máquina feita em conjunto com o grupo do [beco do exploit](http://www.becodoexploit.com) durante uma sexta-hacking 6hack

Comecei enumerando a aplicação web, enquanto outro participante efetuava os scans

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled.png)

Encontrei um email de contato

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%201.png)

Procurando vulnerabilidades no área de “Track Order”

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%202.png)

Ao usar a função ele nos joga para a seguinte URL (é provável de conseguirmos fazer um SQLI)

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%203.png)

Antes disso eu decidi ir voltando nos diretórios para verificar o conteúdo

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%204.png)

Quando chega em v2 ele redireciona para v2/admin/login.html

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%205.png)

Cadastrei um usuário

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%206.png)

Encontrei uma função de resetar a senha do usuário, porém ele bloqueia no front-end mudar o user-name, mas já temos um possível email (info@sky.thm) encontrado na página inicial do site

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%207.png)

Ainda enumerando outras funções foi possível encontrar o email do admin da aplicação, logo temos um alvo mais importante 

[http://10.10.73.198/v2/profile.php](http://10.10.73.198/v2/profile.php)

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%208.png)

Capturei a requisição de troca de senha e de fato consegui alterar na requisição o email 

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%209.png)

Podemos novamente acessar a parte do profile.php e tentar fazer uns uploads de códigos maliciosos na função de upload de imagem do perfil

No código fonte foi possível encontrar a caminho das imagens 

view-source:[http://sky.thm/v2/profile.php](http://sky.thm/v2/profile.php)

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%2010.png)

PS: Tentei encontrar o caminho inspecionando a imagem do perfil, porém levava para um diretório padrão da aplicação. 

Escrevendo uma webshell

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%2011.png)

→ Dica de um dos membros do grupo, o final do comando serve para direcionar o STDOUT e o STERR

[https://explainshell.com/explain?cmd=2>%261](https://explainshell.com/explain?cmd=2%3E%261)

Realizei o upload 

Webshell funcionando, temos o usuário www-data (que geralmente é usuário que hospeda o serviço de servidor web / apache)

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%2012.png)

Progredindo para uma reverse shell, usei um código em php para ganhar acesso 

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%2013.png)

Dentro do sistema foi possível encontrar que ele usa mongoDB

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%2014.png)

No mongoDB eu tive que usar bastante a parte de help para tentar dumpar o banco de dados

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%2015.png)

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%2016.png)

→ Anteriormente eu já havia visto o usuário webdeveloper

webdevelper:BahamasChapp123!@#

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%2017.png)

Se somos um usuário no sistema e temos a senha dele a forma mais fácil de começar a procurar por privilege escalation é verificando as permissões dele no sistema 

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%2018.png)

Com um pouco de pesquisa e ajuda foi possível encontrar uma forma de explorar a LD_PRELOAD

![Untitled](Road%2019cb904616144eeeae126f4c637e447e/Untitled%2019.png)

[https://www.hackingarticles.in/linux-privilege-escalation-using-ld_preload/](https://www.hackingarticles.in/linux-privilege-escalation-using-ld_preload/)